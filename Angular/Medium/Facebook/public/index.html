<!DOCTYPE html>
<html lang="en" ng-app="ExampleApp">
<head>
    <meta charset="UTF-8">
    <title>Facebook Example</title>
    <script src="//connect.facebook.net/en_US/sdk.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script>
        var app = angular.module('ExampleApp', []);

        app.run(function($window) {
            $window.fbAsyncInit = function () {
                FB.init({
                    appId: '1866106250330238',
                    status: true,
                    cookie: true,
                    xfbml: true,
                    version: 'v2.5'
                });
            };
        });
        app.controller('DefaultCtrl', function ($scope) {
            $scope.checkLoginState = function() {
                FB.getLoginStatus(function(response) {
                    showLoginState(response);
                });
            };

            function showLoginState(response) {
                if ( response.status === 'connected') {
                    var token = response.authResponse.accessToken;
                    var expire = response.authResponse.expiresIn;
                    var userId = response.authResponse.userID;
                    $scope.loginState = '로그인된 상태 token : ' +  token + ' expire : ' + expire + ' userId : ' + userId;
                } else if ( response.status === 'not_authorized') {
                    $scope.loginState = '페이스 북에만 로그인 앱에는 로그인 되지 않은 상태';
                } else {
                    $scope.loginState = '페북에 로그인 되지 않은 상태';
                }
            }

            $scope.login = function() {
                FB.login(function(response) {
                    showLoginState(response);
                    if ( response.status === 'connected') {
                    } else if ( response.status === 'not_authorized') {
                    } else {
                    }
                }, {scope: 'public_profile, email, user_friends, user_posts, user_photos, publish_actions'});
            };

            $scope.logout = function() {
                FB.logout(function(response) {
                    console.log('Logout : ', response);
                });
            };

            $scope.showMyInfo = function() {
                FB.api('/me', function(response) {
                    console.log(response);
                    $scope.$apply(function(){
                        $scope.myInfo = JSON.stringify(response);
                    });
                });
            };

            $scope.showPermissions = function() {
                FB.api('/me/permissions', function(response) {
                    console.log(response);
                    $scope.$apply(function() {
                        $scope.permissions = JSON.stringify(response);
                    });
                });
            };

            $scope.showToken = function() {
                FB.getAuthResponse(function(response) {
                    console.log(response);
                    $scope.$apply(function() {
                        $scope.accessToken = JSON.stringify(response);
                    });
                });
            };

            $scope.showFriends = function() {
                FB.api('me/friends?fields=email,name', function(response) {
                    console.log(response);
                    // delayed model change
                    $scope.$apply(function() {
                        $scope.friends = JSON.stringify(response);
                    });
                });
            };

            $scope.showFeed = function() {
                // user_posts
                FB.api('/me/feed', function(response) {
                    if ( response.error ) {
                        console.log('Error!', response.error);
                        return;
                    }
                    console.log(response);
                    $scope.$apply(function() {
                        $scope.feeds = response.data;
                    });
                });
            };
            //feed?fields=comments{from{name, cover},message},message,message_tags,from{name, cover}
            $scope.showAlbum = function() {
                FB.api('/me/albums?fields=cover_photo{picture},count,identified', function(response) {
                    console.log(response);
                });
            }

            $scope.shareContent = function() {
                console.log('share content UI');
                FB.ui({
                            method: 'share',
                            href: 'http://localhost:3000'},
                        // callback
                        function(response) {
                            console.log(response);
                        }
                );
            };

        });

    </script>
</head>
<body ng-controller="DefaultCtrl">


<div>
    <h3>Login/Logout</h3>
    <fb:login-button scope="public_profile,email, user_friends, user_posts, user_photos, publish_actions"></fb:login-button>
    <input type="button" ng-click="login()" value="Custom Login" onlogin="checkLoginState()">
    <input type="button" ng-click="checkLoginState()" value="Login Check">
    <input type="button" ng-click="logout()" value="Logout">
    <p>{{loginState}}</p>
</div>

<div>
    <h3>Graph</h3>
    <input type="button" ng-click="showMyInfo()" value="/me">
    <p>{{myInfo}}</p>
    <input type="button" ng-click="showPermissions()" value="/me/permissions">
    <p>{{permissions}}</p>
    <input type="button" ng-click="showToken()" value="Access Token">
    <p>{{accessToken}}</p>
    <input type="button" ng-click="showFriends()" value="/me/friends">
    <p>{{friends}}</p>
</div>


<div>
    <h3>Content</h3>
    <input type="button" ng-click="showFeed()" value="/me/feed">
    <div>
        <ul ng-repeat="feed in feeds">
            <span ng-if="feed.message">{{feed.message}}</span>
            <span ng-if="feed.story">{{feed.story}}</span>
        </ul>
    </div>
    <input type="button" ng-click="showAlbum()" value="/me/album">
</div>


<div>
    <meta property="og:url" content="http://localhost:3000" />
    <meta property="og:title" content="Facebook Test" />
    <meta property="og:description" content="컨텐츠 공유 테스트" />

    <div>
        <h1>Content sharing</h1>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse eget tristique nibh,
            vel consequat purus. Praesent molestie, turpis ut ultrices commodo, felis arcu cursus enim,
            vel porttitor ante quam vel lacus. Quisque at laoreet sapien. Proin nec purus dolor. Integer
            pharetra nec ligula a condimentum. Fusce sem orci, porta ut felis id, commodo imperdiet risus.
        </p>
        <div class="fb-share-button" data-href="http://localhost:3000" data-layout="button_count">
        </div>
        <input type="button" ng-click="shareContent()" value="share dialog">
    </div>
</div>

</body>
</html>